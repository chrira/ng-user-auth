/**
 * ng-user-auth 0.0.2
 * (c) 2015 Oliver Gugger
 * License: Apache-2.0
 */
!function(){"use strict";angular.module("ngUserAuth",["ui.router","ngLodash","LocalStorageModule"])}(),function(){"use strict";function n(n,e,t,r,o,i){function s(){t.get("$mdDialog").hide();var n=o.path();n.indexOf("unauthorized")<0&&o.url("/unauthorized?requestedPath="+o.path())}function u(){var n=l();return!!n&&e.isString(n)}function a(n){return A=i.post("/authentication",n).then(h)}function c(){return i["delete"]("/authentication").then(function(){g()})}function f(){return A||(A=i.get("/authentication").then(h)),A}function h(e){var t=e.data;return t.token&&(d=t.token,r.set(v,d),n.$broadcast($,!0)),n.$broadcast(m,t),t}function l(){return d&&!e.isEmpty(d)&&e.isString(d)||(d=r.get(v),d&&n.$broadcast($,!0)),d}function g(){d=null,r.remove(v),n.$broadcast($,!1),A=null}var d,A,m="ngUserAuth:userPermissionsChanged",$="ngUserAuth:userLoginStateChanged",v="user.token",p={isLoggedIn:u,login:a,logout:c,getUserToken:l,clearUserToken:g,getUserAuthInfo:f,goToLoginScreen:s,AUTH_INFO_CHANGED_EVENT_NAME:m,LOGIN_STATE_CHANGED_EVENT_NAME:$};return p}angular.module("ngUserAuth").factory("ngUserAuthService",n),n.$inject=["$rootScope","lodash","$injector","localStorageService","$location","$http"]}(),function(){"use strict";function n(n,e,t){function r(){var e=n.defer();return s.push(e),e}function o(n){if(n&&n.$timeout){var e=s.indexOf(n.$timeout);e>=0&&s.splice(e,1)}}function i(){angular.forEach(s,function(n){n.promise.isGloballyCancelled=!0,n.resolve()}),s.length=0}var s=[];return{request:function(n){n=n||{},t.api&&t.api.url&&n.url&&n.url.indexOf(t.api.url)<0&&(n.noCancelOnRouteChange=!0),void 0!==n.timeout||n.noCancelOnRouteChange||(n.$timeout=r(),n.timeout=n.$timeout.promise);var o=e.getUserToken();return o&&(n.headers.Authorization="Bearer "+o),n},response:function(n){return o(n.config),n},responseError:function(t){return t.config.timeout.isGloballyCancelled?n.defer().promise:(o(t.config),401===t.status?(i(),e.clearUserToken(),e.goToLoginScreen()):403===t.status&&(t.hasNoAccess=!0),n.reject(t))}}}angular.module("ngUserAuth").factory("ngUserAuthInterceptor",n),n.$inject=["$q","ngUserAuthService","Config"]}(),function(){"use strict";function n(n,e,t,r){function o(n){t.$on(e.AUTH_INFO_CHANGED_EVENT_NAME,function(e,t){n(t)})}function i(){return $}function s(){return U.promise}function u(){return v}function a(n){U.resolve(),v=n.user,p=n.permissions}function c(n){return v.type===n}function f(n){var e=A(n);return 0===e.length?!0:g(e)}function h(n){var e=A(n);return 0===e.length?!0:d(e)}function l(n){var e=A(n);return 0===e.length?!0:!d(e)}function g(n){return r.every(n,function(n){return r.includes(p,n)})}function d(n){return r.some(n,function(n){return r.includes(p,n)})}function A(n){return void 0===n||r.isEmpty(n)?[]:r.isArray(n)?n:[n]}function m(n,e,t,o){var i=!0;return f(n)||(i=!1),h(e)||(i=!1),l(t)||(i=!1),r.isEmpty(o)||!r.isString(o)||c(o)||(i=!1),i}var $,v,p,U,E="token_read";$=e.isLoggedIn(),t.$on(e.LOGIN_STATE_CHANGED_EVENT_NAME,function(n,e){$=e}),U=n.defer(),e.getUserAuthInfo().then(a),o(a);var y={notifyOnAuthChange:o,isLoggedIn:i,ready:s,getUser:u,userBelongsTo:c,userHasPermission:f,userHasAnyPermission:h,userLacksPermission:l,checkPermissions:m,DEFAULT_LOGGED_IN_PERMISSION_NAME:E};return y}angular.module("ngUserAuth").factory("ngUserAuthInfoService",n),n.$inject=["$q","ngUserAuthService","$rootScope","lodash"]}(),function(){"use strict";function n(n,e,t,r){function o(n,e,r,o,s){if(!(e.$$finishAuthorize||e.data&&e.data.anonymousAccessAllowed)){var c=i(e);c.needsCheck&&(n.preventDefault(),e=angular.extend({$$finishAuthorize:!0},e),t.ready().then(function(){var n=t.checkPermissions(c.hasPermission,c.hasAnyPermission,c.lacksPermission,c.isUserType);n?u(e,r,o,s):a(c.redirectTo,r)}))}}function i(n){var e,r,o,i,u=[];return n.data&&(u=s(n.data.hasPermission),e=n.data.hasAnyPermission,r=n.data.lacksPermission,o=n.data.isUserType,i=n.data.redirectTo),n&&n.data&&n.data.anonymousAccessAllowed||u.push(t.DEFAULT_LOGGED_IN_PERMISSION_NAME),{hasPermission:u,hasAnyPermission:e,lacksPermission:r,isUserType:o,redirectTo:i,needsCheck:u.length>0||e||r}}function s(n){return n?e.isArray(n)?n:[n]:[]}function u(e,t,o,i){r.go(e.name,t,{notify:!1}).then(function(){n.$broadcast("$stateChangeSuccess",e,t,o,i)})}function a(n,e){n?(angular.isFunction(n)&&(n=n()),r.go(n,e)):r.go("forbidden",e)}n.$on("$stateChangeStart",o)}angular.module("ngUserAuth").run(n),n.$inject=["$rootScope","lodash","ngUserAuthInfoService","$state"]}(),function(){"use strict";function n(n,e){function t(t,r,o){function i(){e.checkPermissions(u,a,c,f)?r.show():r.hide()}var s=n.$new(!0),u=s.$eval(o.hasPermission)||o.hasPermission,a=s.$eval(o.hasAnyPermission)||o.hasAnyPermission,c=s.$eval(o.lacksPermission)||o.lacksPermission,f=s.$eval(o.isUserType)||o.isUserType;i(),e.notifyOnAuthChange(i)}var r={link:t};return r}angular.module("ngUserAuth").directive("ngUserAuth",n),n.$inject=["$rootScope","ngUserAuthInfoService"]}();