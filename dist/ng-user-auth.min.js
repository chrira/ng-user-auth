/**
 * ng-user-auth 0.0.3
 * (c) 2015 Puzzle ITC
 * License: Apache-2.0
 */
!function(){"use strict";angular.module("ngUserAuth",["ui.router","ngLodash","LocalStorageModule"])}(),function(){"use strict";function n(n,e,t,r,o,i){function s(){t.get("$mdDialog").hide();var n=o.path();n.indexOf("unauthorized")<0&&o.url("/unauthorized?requestedPath="+o.path())}function u(){var n=g();return!!n&&e.isString(n)}function a(n){return A=i.post("/authentication",n).then(l)}function c(){return i["delete"]("/authentication").then(function(){h()})}function f(){return A||(A=i.get("/authentication").then(l)),A}function l(e){var t=e.data;return t.token&&(d=t.token,r.set($,d),n.$broadcast(v,!0)),n.$broadcast(m,t),t}function g(){return d&&!e.isEmpty(d)&&e.isString(d)||(d=r.get($),d&&n.$broadcast(v,!0)),d}function h(){d=null,r.remove($),n.$broadcast(v,!1),n.$broadcast(m,{user:null,permissions:[]}),A=null}var d,A,m="ngUserAuth:userPermissionsChanged",v="ngUserAuth:userLoginStateChanged",$="user.token",p={isLoggedIn:u,login:a,logout:c,getUserToken:g,clearUserToken:h,getUserAuthInfo:f,goToLoginScreen:s,AUTH_INFO_CHANGED_EVENT_NAME:m,LOGIN_STATE_CHANGED_EVENT_NAME:v};return p}angular.module("ngUserAuth").factory("ngUserAuthService",n),n.$inject=["$rootScope","lodash","$injector","localStorageService","$location","$http"]}(),function(){"use strict";function n(n,e,t){function r(n){n=n||{},t.api&&t.api.url&&n.url&&n.url.indexOf(t.api.url)<0&&(n.noCancelOnRouteChange=!0),void 0!==n.timeout||n.noCancelOnRouteChange||(n.$timeout=s(),n.timeout=n.$timeout.promise);var r=e.getUserToken();return r&&(n.headers.Authorization="Bearer "+r),n}function o(n){return u(n.config),n}function i(t){return t.config.timeout.isGloballyCancelled?n.defer().promise:(u(t.config),401===t.status?(a(),e.clearUserToken(),e.goToLoginScreen()):403===t.status&&(t.hasNoAccess=!0),n.reject(t))}function s(){var e=n.defer();return c.push(e),e}function u(n){if(n&&n.$timeout){var e=c.indexOf(n.$timeout);e>=0&&c.splice(e,1)}}function a(){angular.forEach(c,function(n){n.promise.isGloballyCancelled=!0,n.resolve()}),c.length=0}var c=[],f={request:r,response:o,responseError:i};return f}angular.module("ngUserAuth").factory("ngUserAuthInterceptor",n),n.$inject=["$q","ngUserAuthService","Config"]}(),function(){"use strict";function n(n,e,t,r){function o(){U=e.isLoggedIn(),t.$on(e.LOGIN_STATE_CHANGED_EVENT_NAME,function(n,e){U=e}),S=n.defer(),T=!1,e.getUserAuthInfo().then(f,l),i(f)}function i(n){t.$on(e.AUTH_INFO_CHANGED_EVENT_NAME,function(e,t){n(t)})}function s(){return U}function u(){return S.promise}function a(){return T}function c(){return y}function f(n){S.resolve(),T=!0,y=n.user,E=n.permissions}function l(n){S.reject(n),T=!0}function g(n){return y.type===n}function h(n){var e=$(n);return 0===e.length?!0:m(e)}function d(n){var e=$(n);return 0===e.length?!0:v(e)}function A(n){var e=$(n);return 0===e.length?!0:!v(e)}function m(n){return r.every(n,function(n){return r.includes(E,n)})}function v(n){return r.some(n,function(n){return r.includes(E,n)})}function $(n){return void 0===n||r.isEmpty(n)?[]:r.isArray(n)?n:[n]}function p(n,e,t,o){var i=!0;return h(n)||(i=!1),d(e)||(i=!1),A(t)||(i=!1),r.isEmpty(o)||!r.isString(o)||g(o)||(i=!1),i}var U,y,E,S,T,P="token_read",_={notifyOnAuthChange:i,isLoggedIn:s,isReady:a,whenReady:u,getUser:c,userBelongsTo:g,userHasPermission:h,userHasAnyPermission:d,userLacksPermission:A,checkPermissions:p,DEFAULT_LOGGED_IN_PERMISSION_NAME:P};return o(),_}angular.module("ngUserAuth").factory("ngUserAuthInfoService",n),n.$inject=["$q","ngUserAuthService","$rootScope","lodash"]}(),function(){"use strict";function n(n,e,t,r,o){function i(n,e,i){if(!e.data||!e.data.anonymousAccessAllowed){var u=s(e);u.needsCheck&&(r.whenReady().then(function(){var s=r.checkPermissions(u.hasPermission,u.hasAnyPermission,u.lacksPermission,u.isUserType);r.isLoggedIn()?s?n.defaultPrevented&&o.go(e.name,i):a(u.redirectTo,i):t.goToLoginScreen()}),r.isReady()||n.preventDefault())}}function s(n){var e,t,o,i,s=[];return n.data&&(s=u(n.data.hasPermission),e=n.data.hasAnyPermission,t=n.data.lacksPermission,o=n.data.isUserType,i=n.data.redirectTo),n&&n.data&&n.data.anonymousAccessAllowed||s.push(r.DEFAULT_LOGGED_IN_PERMISSION_NAME),{hasPermission:s,hasAnyPermission:e,lacksPermission:t,isUserType:o,redirectTo:i,needsCheck:s.length>0||e||t}}function u(n){return n?e.isArray(n)?n:[n]:[]}function a(n,e){return n?(angular.isFunction(n)&&(n=n()),o.go(n,e)):o.go("forbidden",e)}n.$on("$stateChangeStart",i)}angular.module("ngUserAuth").run(n),n.$inject=["$rootScope","lodash","ngUserAuthService","ngUserAuthInfoService","$state"]}(),function(){"use strict";function n(n,e){function t(t,r,o){function i(){e.checkPermissions(u,a,c,f)?r.show():r.hide()}var s=n.$new(!0),u=s.$eval(o.hasPermission)||o.hasPermission,a=s.$eval(o.hasAnyPermission)||o.hasAnyPermission,c=s.$eval(o.lacksPermission)||o.lacksPermission,f=s.$eval(o.isUserType)||o.isUserType;i(),e.notifyOnAuthChange(i)}var r={link:t};return r}angular.module("ngUserAuth").directive("ngUserAuth",n),n.$inject=["$rootScope","ngUserAuthInfoService"]}();