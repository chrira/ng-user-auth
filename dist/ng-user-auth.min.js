/**
 * ng-user-auth 0.0.4
 * (c) 2015 Puzzle ITC
 * License: Apache-2.0
 */
!function(){"use strict";angular.module("ngUserAuth",["ui.router","ngLodash","LocalStorageModule"])}(),function(){"use strict";function n(){function n(n,i,s,u,a){function c(){var n=u.path();n.indexOf(t)<0&&u.url(t+"?"+r+"="+u.path())}function f(){var n=v();return!!n&&i.isString(n)}function h(n){return $=a.post(e,n).then(m)}function g(){return a["delete"](e).then(function(){U()})}function l(){return e}function d(){return o}function A(){return $||($=a.get(e).then(m)),$}function m(e){var t=e.data;return t.token&&(E=t.token,s.set(S,E),n.$broadcast(p,!0)),n.$broadcast(P,t),t}function v(){return E&&!i.isEmpty(E)&&i.isString(E)||(E=s.get(S),E&&n.$broadcast(p,!0)),E}function U(){E=null,s.remove(S),n.$broadcast(p,!1),n.$broadcast(P,{user:null,permissions:[]}),$=null}var E,$,P="ngUserAuth:userPermissionsChanged",p="ngUserAuth:userLoginStateChanged",S="user.token",_={isLoggedIn:f,login:h,logout:g,getApiEndpoint:l,getAbortRequestsUrlPrefix:d,getUserToken:v,clearUserToken:U,getUserAuthInfo:A,goToLoginScreen:c,AUTH_INFO_CHANGED_EVENT_NAME:P,LOGIN_STATE_CHANGED_EVENT_NAME:p};return _}var e="/authentication",t="/unauthorized",r="requestedPath",o="/";this.setApiEndpoint=function(n){e=n},this.setUnauthorizedUrl=function(n){t=n},this.setRequestedPathParameterName=function(n){r=n},this.setAbortRequestsUrlPrefix=function(n){o=n},this.$get=n,n.$inject=["$rootScope","lodash","localStorageService","$location","$http"]}angular.module("ngUserAuth").provider("ngUserAuthService",n)}(),function(){"use strict";function n(n,e){function t(n){n=n||{};var t=e.getAbortRequestsUrlPrefix();t&&n.url.indexOf(t)<0&&(n.noCancelOnRouteChange=!0),void 0!==n.timeout||n.noCancelOnRouteChange||(n.$timeout=i(),n.timeout=n.$timeout.promise);var r=e.getUserToken();return r&&(n.headers.Authorization="Bearer "+r),n}function r(n){return s(n.config),n}function o(t){return t.config.timeout.isGloballyCancelled?n.defer().promise:(s(t.config),401===t.status?(u(),e.clearUserToken(),e.goToLoginScreen()):403===t.status&&(t.hasNoAccess=!0),n.reject(t))}function i(){var e=n.defer();return a.push(e),e}function s(n){if(n&&n.$timeout){var e=a.indexOf(n.$timeout);e>=0&&a.splice(e,1)}}function u(){angular.forEach(a,function(n){n.promise.isGloballyCancelled=!0,n.resolve()}),a.length=0}var a=[],c={request:t,response:r,responseError:o};return c}angular.module("ngUserAuth").factory("ngUserAuthInterceptor",n),n.$inject=["$q","ngUserAuthService"]}(),function(){"use strict";function n(n,e,t,r){function o(){E=e.isLoggedIn(),t.$on(e.LOGIN_STATE_CHANGED_EVENT_NAME,function(n,e){E=e}),p=n.defer(),S=!1,e.getUserAuthInfo().then(f,h),i(f)}function i(n){t.$on(e.AUTH_INFO_CHANGED_EVENT_NAME,function(e,t){n(t)})}function s(){return E}function u(){return p.promise}function a(){return S}function c(){return $}function f(n){p.resolve(),S=!0,$=n.user,P=n.permissions}function h(n){p.reject(n),S=!0}function g(n){var e=v(n);return 0===e.length?!0:A(e)}function l(n){var e=v(n);return 0===e.length?!0:m(e)}function d(n){var e=v(n);return 0===e.length?!0:!m(e)}function A(n){return r.every(n,function(n){return r.includes(P,n)})}function m(n){return r.some(n,function(n){return r.includes(P,n)})}function v(n){return void 0===n||r.isEmpty(n)?[]:r.isArray(n)?n:[n]}function U(n,e,t){var r=!0;return g(n)||(r=!1),l(e)||(r=!1),d(t)||(r=!1),r}var E,$,P,p,S,_="token_read",N={notifyOnAuthChange:i,isLoggedIn:s,isReady:a,whenReady:u,getUser:c,userHasPermission:g,userHasAnyPermission:l,userLacksPermission:d,checkPermissions:U,DEFAULT_LOGGED_IN_PERMISSION_NAME:_};return o(),N}angular.module("ngUserAuth").factory("ngUserAuthInfoService",n),n.$inject=["$q","ngUserAuthService","$rootScope","lodash"]}(),function(){"use strict";function n(n,e,t,r,o){function i(n,e,i){if(!e.data||!e.data.anonymousAccessAllowed){var u=s(e);u.needsCheck&&(r.whenReady().then(function(){var s=r.checkPermissions(u.hasPermission,u.hasAnyPermission,u.lacksPermission);r.isLoggedIn()?s?n.defaultPrevented&&o.go(e.name,i):a(u.redirectTo,i):t.goToLoginScreen()}),r.isReady()||n.preventDefault())}}function s(n){var e,t,o,i=[];return n.data&&(i=u(n.data.hasPermission),e=n.data.hasAnyPermission,t=n.data.lacksPermission,o=n.data.redirectTo),n&&n.data&&n.data.anonymousAccessAllowed||i.push(r.DEFAULT_LOGGED_IN_PERMISSION_NAME),{hasPermission:i,hasAnyPermission:e,lacksPermission:t,redirectTo:o,needsCheck:i.length>0||e||t}}function u(n){return n?e.isArray(n)?n:[n]:[]}function a(n,e){return n?(angular.isFunction(n)&&(n=n()),o.go(n,e)):o.go("forbidden",e)}n.$on("$stateChangeStart",i)}angular.module("ngUserAuth").run(n),n.$inject=["$rootScope","lodash","ngUserAuthService","ngUserAuthInfoService","$state"]}(),function(){"use strict";function n(n,e){function t(t,r,o){function i(){e.checkPermissions(u,a,c)?r.show():r.hide()}var s=n.$new(!0),u=s.$eval(o.hasPermission)||o.hasPermission,a=s.$eval(o.hasAnyPermission)||o.hasAnyPermission,c=s.$eval(o.lacksPermission)||o.lacksPermission;i(),e.notifyOnAuthChange(i)}var r={link:t};return r}angular.module("ngUserAuth").directive("ngUserAuth",n),n.$inject=["$rootScope","ngUserAuthInfoService"]}();